{% extends 'layout.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Gerenciamento de Webhooks</h1>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createWebhookModal">
        <i class="fas fa-plus me-2"></i>Criar Novo Webhook
    </button>
</div>

<div class="row mb-4">
    <div class="col-md-12">
        <div class="card shadow">
            <div class="card-header">
                <h5 class="mb-0">Gerenciar Webhooks</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Sessão</th>
                                <th>URL</th>
                                <th>Eventos</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="webhooks-table-body">
                            <tr>
                                <td colspan="7" class="text-center">
                                    <div class="d-flex justify-content-center align-items-center">
                                        <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                                        Carregando webhooks...
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>



<div class="row">
    <div class="col-md-12">
        <div class="card shadow">
            <div class="card-header">
                <h5 class="mb-0">n8n Webhook Integration</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <p>Using webhooks, you can connect WhatsApp events to n8n workflows:</p>
                        <ol>
                            <li>Create a webhook in n8n with the "Webhook" trigger node</li>
                            <li>Copy the n8n webhook URL</li> 
                            <li>Create a webhook here and paste the n8n URL</li>
                            <li>Select the WhatsApp events you want to trigger the workflow</li>
                        </ol>
                        <p>Your n8n workflow will receive a JSON payload with WhatsApp event data when the selected events occur.</p>
                    </div>
                    <div class="col-md-4">
                        <div class="alert alert-info h-100 d-flex align-items-center">
                            <div>
                                <i class="fas fa-info-circle me-2 fa-2x float-start me-3"></i>
                                For best results, create a separate webhook for each type of automation workflow. Each webhook can be configured with specific events to trigger different n8n workflows.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Webhook Modal -->
<div class="modal fade" id="createWebhookModal" tabindex="-1" aria-labelledby="createWebhookModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createWebhookModalLabel">Criar Novo Webhook</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="create-webhook-form">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="webhook-name" class="form-label">Webhook Name</label>
                            <input type="text" class="form-control" id="webhook-name" required placeholder="Enter a name for this webhook">
                        </div>
                        <div class="col-md-6">
                            <label for="webhook-session" class="form-label">WhatsApp Session</label>
                            <select class="form-select" id="webhook-session" required>
                                <option value="">Select a session</option>
                                <!-- Sessions will be loaded dynamically -->
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="webhook-url" class="form-label">Webhook URL</label>
                        <input type="url" class="form-control" id="webhook-url" required placeholder="https://n8n.example.com/webhook/...">
                        <div class="form-text">Enter the n8n webhook URL or any other endpoint that will receive the WhatsApp events.</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Events to Trigger Webhook</label>
                        <div class="row">
                            <div class="col-md-4">
                                <!-- Mensagens básicas -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="message" id="event-message" checked>
                                    <label class="form-check-label" for="event-message" data-bs-toggle="tooltip" title="Dispara quando uma nova mensagem é recebida">
                                        message (Mensagens recebidas)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="message_create" id="event-message-create" checked>
                                    <label class="form-check-label" for="event-message-create" data-bs-toggle="tooltip" title="Dispara quando você envia uma mensagem por este cliente">
                                        message_create (Mensagens enviadas)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="message_revoke_everyone" id="event-message-revoke-everyone" checked>
                                    <label class="form-check-label" for="event-message-revoke-everyone" data-bs-toggle="tooltip" title="Dispara quando uma mensagem é apagada para todos">
                                        message_revoke_everyone (Mensagem apagada)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="message_revoke_me" id="event-message-revoke-me" checked>
                                    <label class="form-check-label" for="event-message-revoke-me" data-bs-toggle="tooltip" title="Dispara quando uma mensagem é apagada para você">
                                        message_revoke_me (Mensagem apagada para mim)
                                    </label>
                                </div>
                                <!-- Status e ações -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="message_ack" id="event-message-ack" checked>
                                    <label class="form-check-label" for="event-message-ack" data-bs-toggle="tooltip" title="Dispara quando muda o status de entrega/leitura (recebida, lida, etc)">
                                        message_ack (Confirmações de leitura)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="message_reaction" id="event-message-reaction" checked>
                                    <label class="form-check-label" for="event-message-reaction" data-bs-toggle="tooltip" title="Dispara quando alguém reage a uma mensagem">
                                        message_reaction (Reações a mensagens)
                                    </label>
                                </div>
                                <!-- APIs de interação -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="send_text" id="event-send-text" checked>
                                    <label class="form-check-label" for="event-send-text" data-bs-toggle="tooltip" title="Dispara quando a API de envio de texto é usada">
                                        send_text (API de envio de texto)
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <!-- Status e indicadores -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="seen" id="event-seen" checked>
                                    <label class="form-check-label" for="event-seen" data-bs-toggle="tooltip" title="Dispara quando marcamos um chat como visto">
                                        seen (Mensagem vista)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="typing" id="event-typing" checked>
                                    <label class="form-check-label" for="event-typing" data-bs-toggle="tooltip" title="Dispara quando você começa a digitar">
                                        typing (Começou a digitar)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="recording" id="event-recording" checked>
                                    <label class="form-check-label" for="event-recording" data-bs-toggle="tooltip" title="Dispara quando alguém começa a gravar áudio">
                                        recording (Gravando áudio)
                                    </label>
                                </div>
                                <!-- Media e mensagens avançadas -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="media_uploaded" id="event-media-uploaded" checked>
                                    <label class="form-check-label" for="event-media-uploaded" data-bs-toggle="tooltip" title="Dispara quando uma mídia é carregada para envio">
                                        media_uploaded (Mídia carregada)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="poll_vote" id="event-poll-vote" checked>
                                    <label class="form-check-label" for="event-poll-vote" data-bs-toggle="tooltip" title="Dispara quando alguém vota em uma enquete">
                                        poll_vote (Voto em enquete)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="order" id="event-order" checked>
                                    <label class="form-check-label" for="event-order" data-bs-toggle="tooltip" title="Dispara quando um pedido é recebido (WhatsApp Business)">
                                        order (Pedido recebido)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="call" id="event-call" checked>
                                    <label class="form-check-label" for="event-call" data-bs-toggle="tooltip" title="Dispara quando uma chamada é recebida ou finalizada">
                                        call (Chamada recebida)
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <!-- Grupos -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="group_join" id="event-group-join" checked>
                                    <label class="form-check-label" for="event-group-join" data-bs-toggle="tooltip" title="Dispara quando alguém entra em um grupo">
                                        group_join (Entrada em grupo)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="group_leave" id="event-group-leave" checked>
                                    <label class="form-check-label" for="event-group-leave" data-bs-toggle="tooltip" title="Dispara quando alguém sai ou é removido de um grupo">
                                        group_leave (Saída de grupo)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="group_update" id="event-group-update" checked>
                                    <label class="form-check-label" for="event-group-update" data-bs-toggle="tooltip" title="Dispara quando informações do grupo são alteradas">
                                        group_update (Atualização de grupo)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="group_admin_changed" id="event-group-admin-changed" checked>
                                    <label class="form-check-label" for="event-group-admin-changed" data-bs-toggle="tooltip" title="Dispara quando administradores do grupo são alterados">
                                        group_admin_changed (Mudança de admin)
                                    </label>
                                </div>
                                <!-- Status da sessão -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="qr" id="event-qr">
                                    <label class="form-check-label" for="event-qr" data-bs-toggle="tooltip" title="Dispara quando um novo QR code é gerado para conexão">
                                        qr (QR code gerado)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="ready" id="event-ready" checked>
                                    <label class="form-check-label" for="event-ready" data-bs-toggle="tooltip" title="Dispara quando a sessão está pronta para uso">
                                        ready (Sessão pronta)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="authenticated" id="event-authenticated" checked>
                                    <label class="form-check-label" for="event-authenticated" data-bs-toggle="tooltip" title="Dispara quando a sessão é autenticada">
                                        authenticated (Autenticado)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="disconnected" id="event-disconnected" checked>
                                    <label class="form-check-label" for="event-disconnected" data-bs-toggle="tooltip" title="Dispara quando a sessão é desconectada">
                                        disconnected (Desconectado)
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Endpoints de API para Integração n8n</label>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Use estes endpoints nos seus fluxos de trabalho n8n para enviar comandos ao WhatsApp
                        </div>
                        
                        <div class="mb-2" id="create-api-endpoints-container">
                            <div class="alert alert-warning">
                                Selecione uma sessão do WhatsApp para visualizar os endpoints de API disponíveis.
                            </div>
                        </div>
                        
                        <div class="accordion" id="createEndpointExamples">
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="createHeadingSendText">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#createCollapseSendText" aria-expanded="false" aria-controls="createCollapseSendText">
                                        Exemplo de Envio de Texto
                                    </button>
                                </h2>
                                <div id="createCollapseSendText" class="accordion-collapse collapse" aria-labelledby="createHeadingSendText" data-bs-parent="#createEndpointExamples">
                                    <div class="accordion-body">
                                        <p>Para enviar uma mensagem de texto, faça uma requisição POST com este corpo JSON:</p>
                                        <pre><code>{
  "chatId": "5511999999999@c.us",
  "message": "Olá do n8n!"
}</code></pre>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="createHeadingSeen">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#createCollapseSeen" aria-expanded="false" aria-controls="createCollapseSeen">
                                        Exemplo de Marcar como Visto
                                    </button>
                                </h2>
                                <div id="createCollapseSeen" class="accordion-collapse collapse" aria-labelledby="createHeadingSeen" data-bs-parent="#createEndpointExamples">
                                    <div class="accordion-body">
                                        <p>Para marcar um chat como visto, faça uma requisição POST com este corpo JSON:</p>
                                        <pre><code>{
  "chatId": "5511999999999@c.us"
}</code></pre>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="createHeadingTyping">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#createCollapseTyping" aria-expanded="false" aria-controls="createCollapseTyping">
                                        Exemplo de Iniciar Digitação
                                    </button>
                                </h2>
                                <div id="createCollapseTyping" class="accordion-collapse collapse" aria-labelledby="createHeadingTyping" data-bs-parent="#createEndpointExamples">
                                    <div class="accordion-body">
                                        <p>Para iniciar a digitação em um chat, faça uma requisição POST com este corpo JSON:</p>
                                        <pre><code>{
  "chatId": "5511999999999@c.us",
  "duration": 3000
}</code></pre>
                                        <p class="text-muted">Nota: duration é em milissegundos e é opcional (padrão: 3000ms)</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Headers personalizados foram removidos conforme solicitado -->
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="webhook-active" checked>
                        <label class="form-check-label" for="webhook-active">Webhook Active</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="create-webhook-btn">Create Webhook</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Webhook Modal -->
<div class="modal fade" id="editWebhookModal" tabindex="-1" aria-labelledby="editWebhookModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editWebhookModalLabel">Editar Webhook</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="edit-webhook-form">
                    <input type="hidden" id="edit-webhook-id">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="edit-webhook-name" class="form-label">Webhook Name</label>
                            <input type="text" class="form-control" id="edit-webhook-name" required>
                        </div>
                        <div class="col-md-6">
                            <label for="edit-webhook-session" class="form-label">WhatsApp Session</label>
                            <select class="form-select" id="edit-webhook-session" required>
                                <option value="">Select a session</option>
                                <!-- Sessions will be loaded dynamically -->
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="edit-webhook-url" class="form-label">Webhook URL</label>
                        <input type="url" class="form-control" id="edit-webhook-url" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Events to Trigger Webhook</label>
                        <div class="row">
                            <div class="col-md-4">
                                <!-- Mensagens básicas -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="message" id="edit-event-message">
                                    <label class="form-check-label" for="edit-event-message" data-bs-toggle="tooltip" title="Dispara quando uma nova mensagem é recebida">
                                        message (Mensagens recebidas)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="message_create" id="edit-event-message-create">
                                    <label class="form-check-label" for="edit-event-message-create" data-bs-toggle="tooltip" title="Dispara quando você envia uma mensagem por este cliente">
                                        message_create (Mensagens enviadas)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="message_revoke_everyone" id="edit-event-message-revoke-everyone">
                                    <label class="form-check-label" for="edit-event-message-revoke-everyone" data-bs-toggle="tooltip" title="Dispara quando uma mensagem é apagada para todos">
                                        message_revoke_everyone (Mensagem apagada)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="message_revoke_me" id="edit-event-message-revoke-me">
                                    <label class="form-check-label" for="edit-event-message-revoke-me" data-bs-toggle="tooltip" title="Dispara quando uma mensagem é apagada para você">
                                        message_revoke_me (Mensagem apagada para mim)
                                    </label>
                                </div>
                                <!-- Status e ações -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="message_ack" id="edit-event-message-ack">
                                    <label class="form-check-label" for="edit-event-message-ack" data-bs-toggle="tooltip" title="Dispara quando muda o status de entrega/leitura (recebida, lida, etc)">
                                        message_ack (Confirmações de leitura)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="message_reaction" id="edit-event-message-reaction">
                                    <label class="form-check-label" for="edit-event-message-reaction" data-bs-toggle="tooltip" title="Dispara quando alguém reage a uma mensagem">
                                        message_reaction (Reações a mensagens)
                                    </label>
                                </div>
                                <!-- APIs de interação -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="send_text" id="edit-event-send-text">
                                    <label class="form-check-label" for="edit-event-send-text" data-bs-toggle="tooltip" title="Dispara quando a API de envio de texto é usada">
                                        send_text (API de envio de texto)
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <!-- Status e indicadores -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="seen" id="edit-event-seen">
                                    <label class="form-check-label" for="edit-event-seen" data-bs-toggle="tooltip" title="Dispara quando marcamos um chat como visto">
                                        seen (Mensagem vista)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="typing" id="edit-event-typing">
                                    <label class="form-check-label" for="edit-event-typing" data-bs-toggle="tooltip" title="Dispara quando você começa a digitar">
                                        typing (Começou a digitar)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="recording" id="edit-event-recording">
                                    <label class="form-check-label" for="edit-event-recording" data-bs-toggle="tooltip" title="Dispara quando alguém começa a gravar áudio">
                                        recording (Gravando áudio)
                                    </label>
                                </div>
                                <!-- Media e mensagens avançadas -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="media_uploaded" id="edit-event-media-uploaded">
                                    <label class="form-check-label" for="edit-event-media-uploaded" data-bs-toggle="tooltip" title="Dispara quando uma mídia é carregada para envio">
                                        media_uploaded (Mídia carregada)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="poll_vote" id="edit-event-poll-vote">
                                    <label class="form-check-label" for="edit-event-poll-vote" data-bs-toggle="tooltip" title="Dispara quando alguém vota em uma enquete">
                                        poll_vote (Voto em enquete)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="order" id="edit-event-order">
                                    <label class="form-check-label" for="edit-event-order" data-bs-toggle="tooltip" title="Dispara quando um pedido é recebido (WhatsApp Business)">
                                        order (Pedido recebido)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="call" id="edit-event-call">
                                    <label class="form-check-label" for="edit-event-call" data-bs-toggle="tooltip" title="Dispara quando uma chamada é recebida ou finalizada">
                                        call (Chamada recebida)
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <!-- Grupos -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="group_join" id="edit-event-group-join">
                                    <label class="form-check-label" for="edit-event-group-join" data-bs-toggle="tooltip" title="Dispara quando alguém entra em um grupo">
                                        group_join (Entrada em grupo)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="group_leave" id="edit-event-group-leave">
                                    <label class="form-check-label" for="edit-event-group-leave" data-bs-toggle="tooltip" title="Dispara quando alguém sai ou é removido de um grupo">
                                        group_leave (Saída de grupo)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="group_update" id="edit-event-group-update">
                                    <label class="form-check-label" for="edit-event-group-update" data-bs-toggle="tooltip" title="Dispara quando informações do grupo são alteradas">
                                        group_update (Atualização de grupo)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="group_admin_changed" id="edit-event-group-admin-changed">
                                    <label class="form-check-label" for="edit-event-group-admin-changed" data-bs-toggle="tooltip" title="Dispara quando administradores do grupo são alterados">
                                        group_admin_changed (Mudança de admin)
                                    </label>
                                </div>
                                <!-- Status da sessão -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="qr" id="edit-event-qr">
                                    <label class="form-check-label" for="edit-event-qr" data-bs-toggle="tooltip" title="Dispara quando um novo QR code é gerado para conexão">
                                        qr (QR code gerado)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="ready" id="edit-event-ready">
                                    <label class="form-check-label" for="edit-event-ready" data-bs-toggle="tooltip" title="Dispara quando a sessão está pronta para uso">
                                        ready (Sessão pronta)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="authenticated" id="edit-event-authenticated">
                                    <label class="form-check-label" for="edit-event-authenticated" data-bs-toggle="tooltip" title="Dispara quando a sessão é autenticada">
                                        authenticated (Autenticado)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="disconnected" id="edit-event-disconnected">
                                    <label class="form-check-label" for="edit-event-disconnected" data-bs-toggle="tooltip" title="Dispara quando a sessão é desconectada">
                                        disconnected (Desconectado)
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Endpoints de API para Integração n8n</label>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Use estes endpoints nos seus fluxos de trabalho n8n para enviar comandos ao WhatsApp
                        </div>
                        
                        <div class="mb-2" id="api-endpoints-container">
                            <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                            Carregando endpoints de API...
                        </div>
                        
                        <div class="accordion" id="endpointExamples">
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingSendText">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSendText" aria-expanded="false" aria-controls="collapseSendText">
                                        Exemplo de Envio de Texto
                                    </button>
                                </h2>
                                <div id="collapseSendText" class="accordion-collapse collapse" aria-labelledby="headingSendText" data-bs-parent="#endpointExamples">
                                    <div class="accordion-body">
                                        <p>Para enviar uma mensagem de texto, faça uma requisição POST com este corpo JSON:</p>
                                        <pre><code>{
  "chatId": "5511999999999@c.us",
  "message": "Olá do n8n!"
}</code></pre>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingSeen">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSeen" aria-expanded="false" aria-controls="collapseSeen">
                                        Exemplo de Marcar como Visto
                                    </button>
                                </h2>
                                <div id="collapseSeen" class="accordion-collapse collapse" aria-labelledby="headingSeen" data-bs-parent="#endpointExamples">
                                    <div class="accordion-body">
                                        <p>Para marcar um chat como visto, faça uma requisição POST com este corpo JSON:</p>
                                        <pre><code>{
  "chatId": "5511999999999@c.us"
}</code></pre>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingTyping">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTyping" aria-expanded="false" aria-controls="collapseTyping">
                                        Exemplo de Iniciar Digitação
                                    </button>
                                </h2>
                                <div id="collapseTyping" class="accordion-collapse collapse" aria-labelledby="headingTyping" data-bs-parent="#endpointExamples">
                                    <div class="accordion-body">
                                        <p>Para iniciar a digitação em um chat, faça uma requisição POST com este corpo JSON:</p>
                                        <pre><code>{
  "chatId": "5511999999999@c.us",
  "duration": 3000
}</code></pre>
                                        <p class="text-muted">Nota: duration é em milissegundos e é opcional (padrão: 3000ms)</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Headers personalizados foram removidos conforme solicitado -->
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="edit-webhook-active">
                        <label class="form-check-label" for="edit-webhook-active">Webhook Active</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="update-webhook-btn">Update Webhook</button>
            </div>
        </div>
    </div>
</div>

<!-- Confirm Delete Modal -->
<div class="modal fade" id="deleteWebhookModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this webhook? This action cannot be undone.</p>
                <p><strong>Webhook: </strong><span id="delete-webhook-name"></span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-delete-webhook-btn">Delete</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/webhooks.js') }}"></script>
{% endblock %}
